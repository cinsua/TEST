<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for mini-forum\v1\services\hateoas.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">mini-forum/v1/services/</a> hateoas.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">89.47% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>34/38</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">80% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>20/25</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/1</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.18% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>31/34</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">731×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">94×</span>
<span class="cline-any cline-yes">40×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">&nbsp;
/*#################################################################
#         Fill the response with posible links                    #
#################################################################*/
&nbsp;
const utils = require('../utils/utils')
&nbsp;
module.exports = {
&nbsp;
  addLinks: (result, paginationInfo, credentials, routes) =&gt; {
    let { bestRole, route, originalUrl } = credentials
    role = bestRole
    let pagination = undefined
    // should keep others query params
    urlWithoutQuery = originalUrl.split('?')[0]
&nbsp;
    if (paginationInfo) {
      pagination = {
        totalPages: paginationInfo.totalPages,
        page: paginationInfo.page,
        totalDocs: paginationInfo.totalDocs,
        limit: paginationInfo.limit
      }
      pagination.links = []
      <span class="missing-if-branch" title="else path not taken" >E</span>if (!utils.arraysEqual(result, [])) {
        pagination.links = [{
          type: 'GET', rel: 'first',
          href: `${urlWithoutQuery}?page=1&amp;limit=${paginationInfo.limit}`
        },]
      }
      <span class="missing-if-branch" title="if path not taken" >I</span>if (paginationInfo.hasPrevPage)
<span class="cstat-no" title="statement not covered" >        pagination.links.push({</span>
          type: 'GET', rel: 'prev',
          href: `${urlWithoutQuery}?page=${paginationInfo.prevPage}&amp;limit=${paginationInfo.limit}`
        })
      <span class="missing-if-branch" title="if path not taken" >I</span>if (paginationInfo.hasNextPage)
<span class="cstat-no" title="statement not covered" >        pagination.links.push({</span>
          type: 'GET', rel: 'next',
          href: `${urlWithoutQuery}?page=${paginationInfo.nextPage}&amp;limit=${paginationInfo.limit}`
        })
&nbsp;
      <span class="missing-if-branch" title="if path not taken" >I</span>if (paginationInfo.totalPages &gt; 1)
<span class="cstat-no" title="statement not covered" >        pagination.links.push({</span>
          type: 'GET', rel: 'last',
          href: `${urlWithoutQuery}?page=${paginationInfo.pages}&amp;limit=${paginationInfo.limit}`
        })
    }
&nbsp;
    data = { pagination, result }
    links = getChilds(role, route, originalUrl, routes)
    if (Array.isArray(links) &amp;&amp; links.length) data.links = links
    return data
  }
}
&nbsp;
function getChilds(role, route, originalUrl, routes) {
&nbsp;
  // we standarize with / at the end of urls. and delete query params
  <span class="missing-if-branch" title="if path not taken" >I</span>if (originalUrl.includes('?')) <span class="cstat-no" title="statement not covered" >originalUrl = originalUrl.split('?')[0]</span>
  if (!originalUrl.endsWith('/')) originalUrl += '/'
  if (!route.endsWith('/')) route += '/'
&nbsp;
  // map all child routes that not have ':' after the route provided:
  // not having ':' means that is not a specific resourse
  childRoutes = Object.keys(routes)
    .filter((r) =&gt; (r !== route &amp;&amp; r.startsWith(route) &amp;&amp; !r.split(route)[1].includes(':')))
    .map((r) =&gt; (r.split(route)[1]))
&nbsp;
  links = []
&nbsp;
  // nested sh*t ... we should refactor
  for (r of childRoutes) {
    for (method of Object.keys(routes[route + r])) {
      if (routes[route + r][method].roleRequired.includes(role)) {
        links.push({
          type: method,
          rel: routes[route + r][method].description,
          href: originalUrl + r
        })
      }
    }
  }
&nbsp;
  return links
&nbsp;
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Jan 11 2019 10:05:04 GMT-0300 (GMT-03:00)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
